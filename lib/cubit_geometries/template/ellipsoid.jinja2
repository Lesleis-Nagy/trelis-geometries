###############################################################################
#
# Ellipsoid. Major axis is always along x. Intermediate axis is always along y.
# Minor axis is always along z.
#
# phi    - the golden ratio
# invPhi - the inverse of the golden ratio
# ESVD   - equivalent spherical volume diameter
# PRO    - prolateness (major/intermediate axis)
# OBL    - oblateness (minor/intermediate axis)
# esize  - element size
#
# S      - scale factor
# V      - standard dodecahedron volume
#
# {phi=(1 + sqrt(5))/2}
# {invPhi=2/(1 + sqrt(5))}
# {pi=atan2(0,-1)}
# {ESVD={{ esvd_size }}}
# {PRO={{ prolateness }}}
# {OBL={{ oblateness }}}
# {esize={{ element_size }}}
#
###############################################################################

reset

create sphere radius 0.1

###############################################################################
# Scale geometry to the desired aspect ratio along the x-axis direction
###############################################################################

volume 1 scale X {PRO} Y 1.0 Z {1/OBL}

###############################################################################
# Scale geometry so that it has volume equivalent to a sphere of diameter ESVD
###############################################################################

# {V=Volume(1)}
# {DUMP()}
# {S=((pi/(6*V))^(1/3))*ESVD}
volume 1 scale {S}

###############################################################################
# Mesh the volume
###############################################################################
volume all scheme tetmesh
volume all size {esize}
mesh volume all

block 101 add volume all
block 101 element type tetra4

export patran "{{ abs_mesh_file }}"  overwrite  everything

{% if abs_exodus_mesh_file is not none %}
export mesh "{{ abs_exodus_mesh_file }}" overwrite
{% endif %}
